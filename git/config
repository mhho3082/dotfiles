[user]
    # Please change this to your own user name and email
    name = Max Ho
    email = 73323597+mhho3082@users.noreply.github.com

    # Please put your GPG key ID here
    # Find with `gpg --list-keys --keyid-format long`
    signingkey = DADA239B

[core]
    editor = nvim
    eol = lf
    autocrlf = false

[init]
    defaultBranch = main

[push]
    default = current
    followTags = true

[code]
    editor = nvim

[fetch]
    prune = true

[commit]
    gpgSign = true

[tag]
    gpgSign = true

# ---

# Some ideas from https://github.com/mathiasbynens/dotfiles

[alias]
    a = add
    aa = add --all
    ai = add --interactive
    ap = add --patch
    an = add --all --intent-to-add # Add new: for adding (but not staging) new files

    b = branch
    bd = branch --delete

    c = commit
    ci = commit --interactive

    co = checkout
    cl = clone
    cp = cherry-pick

    # `git d i` Diff between i revisions ago and current
    d = !"d() { git diff --patch-with-stat HEAD~${1:-0}; };d"
    # Use difftool for such diff
    df = !"d() { git difftool --patch-with-stat HEAD~${1:-0}; }; d"

    p = push
    pu = pull

    s = stash --include-untracked
    si = stash --patch
    sp = stash pop

    m = merge

    # https://stackoverflow.com/questions/26961371/switch-on-another-branch-create-if-not-exists-without-checking-if-already-exi
    cd = !"f() { git checkout ${1:-$(git default-branch)} 2>/dev/null || git checkout -b ${1:-$(git default-branch)} 2>/dev/null; }; f"

    # https://joshtronic.com/2020/08/09/how-to-get-the-default-git-branch/
    # Also handles repos without remote by responding the config's default branch instead
    default-branch = !"git symbolic-ref refs/remotes/origin/HEAD &>/dev/null && (git symbolic-ref refs/remotes/origin/HEAD | sed 's@^refs/remotes/origin/@@') 2>/dev/null || git config --get init.defaultBranch"

    # https://stackoverflow.com/questions/1838873/visualizing-branch-topology-in-git/34467298#34467298
    l = l1
    l1 = l1-specific --all
    l2 = l2-specific --all
    l3 = l3-specific --all

    l1-specific = log --graph --abbrev-commit --decorate --format=format:'%C(bold blue)%h%C(reset) - %C(bold green)(%ar)%C(reset) %C(white)%s%C(reset) %C(dim white)- %an%C(reset)%C(auto)%d%C(reset)'
    l2-specific = log --graph --abbrev-commit --decorate --format=format:'%C(bold blue)%h%C(reset) - %C(bold cyan)%aD%C(reset) %C(bold green)(%ar)%C(reset)%C(auto)%d%C(reset)%n''          %C(white)%s%C(reset) %C(dim white)- %an%C(reset)'
    l3-specific = log --graph --abbrev-commit --decorate --format=format:'%C(bold blue)%h%C(reset) - %C(bold cyan)%aD%C(reset) %C(bold green)(%ar)%C(reset) %C(bold cyan)(committed: %cD)%C(reset) %C(auto)%d%C(reset)%n''          %C(white)%s%C(reset)%n''          %C(dim white)- %an <%ae> %C(reset) %C(dim white)(committer: %cn <%ce>)%C(reset)'

    # whatchanged
    w = log --all --abbrev-commit --decorate --format=format:'%C(bold blue)%h%C(reset) - %C(bold green)(%ar)%C(reset) %C(white)%s%C(reset) %C(dim white)- %an%C(reset)%C(auto)%d%C(reset)' --raw --no-merges

    # Get all recent updates
    sync = pull --rebase --all
    # Force local changes up to remotes
    force = push --all --force-with-lease
    # Save and push all temporary changes in case of emergency
    emergency = !"git checkout -B \"EMERGENCY-$(git config user.email)\"; git add -A; git commit -m \"WIP: Emergency commit on $(date +%d/%m/%Y\\ %H:%M:%S)\"; git push --force"

    # https://gggritso.com/human-git-aliases
    # Remove all changes from staging
    unstage = reset --mixed HEAD --
    # Remove all changes made, including untracked files
    discard = !"git reset --hard HEAD && git clean -d -f"
    # Undo last commit softly
    uncommit = reset HEAD~1 --mixed
    # Amend the recent commit
    amend = commit --amend

    # https://www.reddit.com/r/programming/comments/1febgy/handy_git_tips_to_stop_you_getting_fired/
    # Handle merge conflicts easily
    ours = "!f() { git checkout --ours $@ && git add $@; }; f"
    theirs = "!f() { git checkout --theirs $@ && git add $@; }; f"

    # Remove merged branches
    # (https://dev.to/wojciechko/git-alias-to-delete-merged-branches-3cop)
    cleanup = !"f() { git branch --merged ${1:-main} | grep -E -v \"(^\\*|${1:-main}|main|master|dev)\" | xargs --no-run-if-empty git branch -d;  };f"

    # Remove unused objects in the .git directory
    prune = gc --prune=now --aggressive

    # Show verbose data
    stat = status --short --branch
    tags = tag -l
    branches = branch --all --format='%(HEAD) %(color:yellow)%(refname:short)%(color:reset) - %(contents:subject) %(color:green)(%(committerdate:relative)) [%(authorname)]' --sort=-committerdate
    remotes = remote --verbose
    contributors = shortlog --summary --numbered --no-merges
    stashes = stash list
    latest = log -1 HEAD --stat --decorate --format=format:'%C(bold blue)%h%C(reset) - %C(bold green)(%ar)%C(reset) %C(white)%s%C(reset) %C(dim white)- %an%C(reset)%C(auto)%d%C(reset)'

    # Get SHA of head, useful in detached head
    sha = rev-parse --short HEAD

# ---

[log]
    decorate = true
    abbrevCommit = true

[format]
    pretty = "%C(magenta)%h%Creset -%C(red)%d%Creset %s %C(green)(%cr) %C(cyan)<%an>%Creset"

# ---

[pager]
    difftool = true

# ---

[merge]
    tool = nvim
    conflictstyle = diff3

[mergetool]
  prompt = false

[mergetool "nvim"]
    cmd = nvim -f -c \"Gdiffsplit!\" \"$MERGED\"

[mergetool "vscode"]
    cmd = code --wait $MERGED

# ---

[diff]
    tool = difftastic

[difftool]
    prompt = false

[difftool "difftastic"]
    cmd = difft "$LOCAL" "$REMOTE"


[difftool "nvimdiff"]
    cmd = "nvim -d \"$LOCAL\" \"$REMOTE\""

[difftool "vscode"]
    cmd = code --wait --diff $LOCAL $REMOTE

# ---

[filter "lfs"]
    smudge = git-lfs smudge -- %f
    process = git-lfs filter-process
    required = true
    clean = git-lfs clean -- %f

# ---

[credential "https://github.com"]
    helper = !/usr/bin/gh auth git-credential

[credential "https://gist.github.com"]
    helper = !/usr/bin/gh auth git-credential

[url "git@github.com:"]
    insteadOf = "gh:"
    pushInsteadOf = "github:"
    pushInsteadOf = "git://github.com/"

[url "git://github.com/"]
    insteadOf = "github:"

[url "git@gist.github.com:"]
    insteadOf = "gst:"
    pushInsteadOf = "gist:"
    pushInsteadOf = "git://gist.github.com/"

[url "git://gist.github.com/"]
    insteadOf = "gist:"

# vim:ft=gitconfig
